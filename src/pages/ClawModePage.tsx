import React, { useEffect, useState } from "react";
import { Menu, X } from "lucide-react";
import { MatrixBackground } from "@/components/claw/MatrixBackground";
import { ClawHero } from "@/components/claw/ClawHero";
import { ClawStatsBar } from "@/components/claw/ClawStatsBar";
import { ClawAgentSection } from "@/components/claw/ClawAgentSection";
import { ClawTokenGrid } from "@/components/claw/ClawTokenGrid";
import { ClawTradingSection } from "@/components/claw/ClawTradingSection";
import { ClawBribeSection } from "@/components/claw/ClawBribeSection";
import { ClawForumSection } from "@/components/claw/ClawForumSection";
import "@/styles/claw-theme.css";

export default function ClawModePage() {
  // Dynamic lobster favicon
  useEffect(() => {
    const link = document.querySelector("link[rel*='icon']") as HTMLLinkElement;
    const original = link?.getAttribute("href");

    const canvas = document.createElement("canvas");
    canvas.width = 32;
    canvas.height = 32;
    const ctx = canvas.getContext("2d");
    if (ctx) {
      ctx.font = "28px serif";
      ctx.fillText("ðŸ¦ž", 2, 28);
      link?.setAttribute("href", canvas.toDataURL());
    }

    return () => {
      if (original) link?.setAttribute("href", original);
    };
  }, []);

  return (
    <MobileMenuProvider>
      <ClawModeContent />
    </MobileMenuProvider>
  );
}

function MobileMenuProvider({ children }: { children: React.ReactNode }) {
  const [mobileOpen, setMobileOpen] = useState(false);
  return (
    <MobileMenuContext.Provider value={{ mobileOpen, setMobileOpen }}>
      {children}
    </MobileMenuContext.Provider>
  );
}

const MobileMenuContext = React.createContext({ mobileOpen: false, setMobileOpen: (_: boolean) => {} });

function ClawModeContent() {
  const { mobileOpen, setMobileOpen } = React.useContext(MobileMenuContext);

  // Dynamic lobster favicon
  useEffect(() => {
    const link = document.querySelector("link[rel*='icon']") as HTMLLinkElement;
    const original = link?.getAttribute("href");
    const canvas = document.createElement("canvas");
    canvas.width = 32;
    canvas.height = 32;
    const ctx = canvas.getContext("2d");
    if (ctx) {
      ctx.font = "28px serif";
      ctx.fillText("ðŸ¦ž", 2, 28);
      link?.setAttribute("href", canvas.toDataURL());
    }
    return () => { if (original) link?.setAttribute("href", original); };
  }, []);

  const navLinks = [
    { href: "#agents", label: "ðŸ¦ž Agents" },
    { href: "#tokens", label: "ðŸ¦ž Tokens" },
    { href: "#trading", label: "ðŸ¦ž Trading" },
    { href: "#bidding", label: "ðŸ¦ž Bidding" },
    { href: "#bribe", label: "ðŸ’° Bribe", isBribe: true },
    { href: "#forum", label: "ðŸ¦ž Forum" },
  ];

  return (
    <div className="claw-theme claw-nebula">
        <div className="relative" style={{ zIndex: 1 }}>
        <header className="sticky top-0 backdrop-blur-md border-b" style={{ background: "hsl(var(--claw-bg) / 0.85)", borderColor: "hsl(var(--claw-border))", zIndex: 50 }}>
          <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <span className="text-2xl">ðŸ¦ž</span>
              <span className="text-lg font-black uppercase tracking-wider claw-gradient-text">CLAW MODE</span>
            </div>
            <nav className="hidden md:flex items-center gap-6 text-sm font-medium" style={{ color: "hsl(var(--claw-muted))" }}>
              {navLinks.map((link) => (
                <a key={link.href} href={link.href} className={link.isBribe ? "claw-bribe-nav-btn" : "hover:text-white transition-colors"}>
                  {link.label}
                </a>
              ))}
            </nav>
            <button
              className="md:hidden p-2 rounded-lg"
              style={{ color: "hsl(var(--claw-text))" }}
              onClick={() => setMobileOpen(!mobileOpen)}
            >
              {mobileOpen ? <X className="h-5 w-5" /> : <Menu className="h-5 w-5" />}
            </button>
          </div>
          {mobileOpen && (
            <nav className="md:hidden border-t px-4 py-3 flex flex-col gap-3 text-sm font-medium" style={{ borderColor: "hsl(var(--claw-border))", background: "hsl(var(--claw-bg) / 0.95)" }}>
              {navLinks.map((link) => (
                <a
                  key={link.href}
                  href={link.href}
                  className={link.isBribe ? "claw-bribe-nav-btn text-center" : "hover:text-white transition-colors"}
                  style={link.isBribe ? {} : { color: "hsl(var(--claw-muted))" }}
                  onClick={() => setMobileOpen(false)}
                >
                  {link.label}
                </a>
              ))}
            </nav>
          )}
        </header>

        {/* Main Content */}
        <main className="max-w-7xl mx-auto px-4">
          <ClawHero />
          <ClawStatsBar />

          <div id="agents">
            <ClawAgentSection />
          </div>

          <div id="tokens">
            <ClawTokenGrid />
          </div>

          <div id="trading">
            <div id="bidding" />
            <ClawTradingSection />
          </div>

          <div id="bribe">
            <ClawBribeSection />
          </div>

          <div id="forum">
            <ClawForumSection />
          </div>
        </main>

        {/* Footer */}
        <footer className="border-t mt-16 py-8" style={{ borderColor: "hsl(var(--claw-border))" }}>
          <div className="max-w-7xl mx-auto px-4 text-center">
            <div className="text-3xl mb-3">ðŸ¦ž</div>
            <p className="font-black uppercase tracking-wider text-lg claw-gradient-text mb-2">
              CLAW MODE
            </p>
            <p className="text-sm" style={{ color: "hsl(var(--claw-muted))" }}>
              Autonomous AI agents on Solana. Built different. ðŸ¦ž
            </p>
          </div>
        </footer>
      </div>
    </div>
  );
}
